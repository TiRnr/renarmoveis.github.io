<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Registro de Acesso</title>
</head>
<body>

<div id="info" style="font-family: Arial; padding: 20px;"></div>

<script>
// 1. Pega o usuário da URL
const params = new URLSearchParams(window.location.search);
let user = "desconhecido";

if (params.has("u") && params.get("u").trim() !== "") {
    user = params.get("u").trim();
}

// Força log para debug
console.log("Usuário detectado:", user);


// 2. Mostra o usuário detectado
document.getElementById("info").innerHTML = `
  <h2>Usuário detectado: <strong>${user}</strong></h2>
  <p>Registrando acesso...</p>
`;

// 3. Obtém o IP público e envia os dados
fetch("https://api.ipify.org?format=json")
  .then(r => r.json())
  .then(ipData => {

    // Envia para o Google Sheets
    fetch("https://script.google.com/macros/s/AKfycbzUmtkzizRcVm8jOeX4lf73sRoX2H7HxvKG_5DZLW6JfX-e5b1wYjyDTLFznlBMhq55zw/exec", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        user: user,
        ip: ipData.ip,
        agent: navigator.userAgent
      })
    })
    .then(() => {
      // Atualiza mensagem após registrar
      document.getElementById("info").innerHTML += `
        <p style="color: green;">Acesso registrado com sucesso!</p>
      `;
    })
    .catch(err => {
      document.getElementById("info").innerHTML += `
        <p style="color: red;">Erro ao registrar acesso.</p>
      `;
    });

});
</script>

<hr>

<!-- Formulário -->
<div style="font-family: Arial; padding: 20px;">
  <h3>Formulário</h3>
  <form>
